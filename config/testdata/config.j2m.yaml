modules:
  delta_powershelf:
    prober: json_collector
    json_collector:
      redfishRoot: /redfish/v1/Chassis/PowerShelf_0/Sensors
      jq: |-
        [.Oem.deltaenergysystems.AllSensors.Sensors[]] |
        map({
          name: (if .DeviceName | test("^ps[0-9]+_") then .DeviceName | sub("^ps[0-9]+_"; "") else .DeviceName end),
          value: .Reading,
          labels: (
            if .DeviceName | test("^ps[0-9]+_") then {"power_supply_id": (.DeviceName | split("_")[0])}
            else {}
            end),
            _raw: .
        }) |
        map(.help = "Value yielded from the Redfish API /Chassis/PowerShelf_0, expanded 1 level") | map(del(._raw)) | sort_by(.name)
